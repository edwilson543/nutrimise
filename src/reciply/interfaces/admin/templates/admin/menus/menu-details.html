{% extends "admin/base_site.html" %}
{% load admin_urls i18n %}

{% block title %}
    {{ menu.name }} {{ block.super }}
{% endblock %}

{% block breadcrumbs %}
    <div class="breadcrumbs">
        <a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
        &rsaquo; <a href="{% url 'admin:app_list' app_label='menus' %}">menus</a>
        &rsaquo; <a href="{% url 'admin:menus_menu_changelist' %}">menus</a>
        &rsaquo; {{ menu.name }}
    </div>
{% endblock %}

{% block content %}

    <div id="basic-info">
        <h1>{{ menu.name }}</h1>
        <p>{{menu.description}}</p>
    </div>
    <hr>

    <form id="optimise-menu" action="{% url 'menu-optimise' menu_id=menu.id %}" method="post">
        {% csrf_token %}
        <div class="submit-row">
            <input type="submit" value="Optimise" class="default" name="_save">
        </div>
    </form>

    <div id="menu-items">
        <h2>Meal schedule</h2>
        <a href="{% url 'admin:menus_menu_change' object_id=menu.id %}" target="_blank">
            Edit
        </a>
        <table>
            <tr>
                <th></th>
                {% for day in days %}
                    <th>{{ day.label }}</th>
                {% endfor %}
            </tr>
            {{ menu_items }}
            {% for meal_time, days in meal_schedule.items %}
                <tr>
                    <td><b>{{ meal_time.label }}</b></td>
                    {% for day, menu_item in days.items %}
                        {% if menu_item.recipe_id %}
                            <td>
                                <a href="{% url 'recipe-details' recipe_id=menu_item.recipe_id %}" target="_blank">
                                    {{ menu_item.recipe.name }}
                                </a>
                            </td>
                        {% else %}
                            <td>
                                <a href="{% url 'admin:menus_menuitem_change' object_id=menu_item.id %}" target="_blank">
                                    Select
                                </a>
                            </td>
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
    </div>
    <hr>

    <div id="menu-requirements">
        <h2>Requirements</h2>
        {% if not menu.requirements %}
            <p>Menu has no requirements!</p>
            Select here
        {% else %}
            <p>
                <b>Maximum occurrences per recipe:</b> {{ menu.menu_requirements.maximum_occurrences_per_recipe }}
            </p>
        {% endif %}
    </div>

    <div id="nutritional-information">
        <h2>Nutritional information</h2>
        <h3>Per serving</h3>
        <table>
            <tr>
                <th>Nutrient</th>
                <th>Grams</th>
            </tr>
            {% for nutrient in nutritional_information %}
                <tr>
                    <td>{{ nutrient.nutrient.name }}</td>
                    <td>{{ nutrient.nutrient_quantity_grams | floatformat:"1" }}</td>
                </tr>
            {% endfor %}
        </table>
    </div>
    <hr>

{% endblock %}
